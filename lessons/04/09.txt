Giving the Comments an isDeleted Flag

 Для некоторых комментариев к статьям нужно поле удалено.


*** Adding Comment.isDeleted Field ***
    С помощью консольной команды
            php bin/console make:entity

                                 Class name of the entity to create or update (e.g. OrangePizza):
                                 > Comment

                                 Your entity already exists! So let's add some new fields!

                                 New property name (press <return> to stop adding fields):
                                 > isDeleted

                                 Field type (enter ? to see all types) [boolean]:
                                 >

                                 Can this field be null in the database (nullable) (yes/no) [no]:
                                 >

                                 updated: src/Entity/Comment.php

                                 Add another property? Enter the property name (or press <return> to stop adding fields):
                                 >



                                  Success!


                                 Next: When you're ready, create a migration with make:migration


 Далее как обычно создаем файл миграции
            bin/console make:migration
 И пременими его
            bin/console doctrine:migrations:migrate

 Перед применением Фикстур, установим в сущность  Comment  значение по умолчанию  для свойства.
                        /**
                         * @ORM\Column(type="boolean")
                         */
                        private $isDeleted = false;

 А в класс фикстур   /src/DataFixtures/CommentFixture.php
                 $comment->setIsDeleted($this->faker->boolean(20));
   тогда 20 процентов комментов будут иметь флаг удаленные.

    В шаблоне пока что визуально отразим помеченные как удаленные
                                {% if comment.isDeleted %}
                                    <span class="fa fa-close"></span> deleted
                                {% endif %}

 Применить фикстуры
            php bin/console doctrine:fixtures:load



*** Hiding Deleted Comments ***
    Конечно же нужно не выводить deleted, как делалось выше, а не показывать их.

    В шаблоне сейчас
        {% for comment in article.comments %}

    которое исользует  из src/Entity/Article.php   метод возвращает все
                /**
                 * @return Collection|Comment[]
                 */
                public function getComments(): Collection
                {
                    return $this->comments;
                }

*** Creating Article::getNonDeletedComments() ***
*** Filtering Deleted Comments in Article::getNonDeletedComments() ***

Неверный способ отфильтровать удаленные комментарии
            /**
             * @return Collection|Comment[]
             */
            public function getNonDeletedComments(): Collection
            {
                $comments = [];

                foreach ($this->getComments() as $comment) {
                    if (!$comment->getIsDeleted()) {
                        $comments[] = $comment;
                    }
                }

                return new ArrayCollection($comments);
            }










